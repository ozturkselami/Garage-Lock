#include <main.h>
#include <string.h>
#define LCD_ENABLE_PIN PIN_B5
#define LCD_RS_PIN PIN_B7
#define LCD_RW_PIN PIN_B6
#define LCD_DATA4 PIN_B3
#define LCD_DATA5 PIN_B2
#define LCD_DATA6 PIN_B1
#define LCD_DATA7 PIN_B0

#define use_portb_lcd TRUE
#include <lcd.c>
//#include <Flex_kbd.c> // http://www.ccsinfo.com/forum/viewtopic.php?t=26333

char *password1[] = {'1','2','3','4'};
char *password2[] = {'9','7','5','3'};
char *enteredPW[] = {'X', 'X', 'X', 'X'};



void lcdClear()
{
   lcd_send_byte(0, 0x1);  
}

void CursorBlink()
{
   lcd_send_byte(0, 0x0F);  
}




void main()
{
   set_tris_d(0b01111000);
   int cnt = 0;

   lcd_init(); // LCD Display Initialize
   lcdClear(); // Clear LCD Display
   welcomeMsg();
   //loop
   for(;;)
   {  
      pressedBtn = getPressedBtn();
      if(pressedBtn != 'I' && pressedBtn != '*' && pressedBtn != '#')
      {
         //0-9 Sayýlarýndan Biri Tuþlandýysa
         //Art Arda 4 Sayýdan Fazla Girilirse 4.den Sonrasýný Alma
         if(isBtnPressed && cnt < 4){
            enteredPW[cnt] = pressedBtn;
            printf(lcd_putc,"\fSIFRENIZ: %c",enteredPW[0]);
            for(int i = 1; i <= 3; i++)
            {
               printf(lcd_putc,"%c", enteredPW[i]);
            }
            printf(lcd_putc, "\nGIRIS ICIN #");
            delay_ms(250);
            isBtnPressed = 0;
            cnt++;
         }
      }
      
      if(pressedBtn == '#' && isBtnPressed)
      {
         int status = checkPW();
         isBtnPressed = 0;
         //Þifre girildi þifreyi kontrol et doðruysa aç
         if(status == 1)
         {
            delay_ms(2000);
            openDoor();
            delay_ms(2000);
            closeDoor();
         }
         welcomeMsg();
         for(int i = 0; i < 4; i++){enteredPW[i] = 'X';}
         cnt = 0;
      }
      
      if(pressedBtn == '*' && isBtnPressed)
      {
         isBtnPressed = 0;
         //Girilen Þifrenin Son Hanesini Sil
         delFunc(cnt);
      }
   }
}
